<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat3P</title>

  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;
      --shadow:0 10px 30px rgba(2,6,23,.08);
      --radius:16px;
      --focus:rgba(59,130,246,.25);
      --accent:#0f766e;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(15,118,110,.18), transparent 60%),
                  radial-gradient(900px 500px at 90% 0%, rgba(37,99,235,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width: 980px;
      margin: 40px auto;
      padding: 0 16px;
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 18px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 220px;
    }

    .logo{
      width:44px;
      height:44px;
      border-radius:12px;
      background:#fff;
      border:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow: 0 6px 16px rgba(2,6,23,.06);
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:contain;
      padding:6px;
    }

    .title{
      line-height:1.1;
    }
    .title h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
    }
    .title p{
      margin:4px 0 0;
      font-size: 13px;
      color:var(--muted);
    }

    .pill{
      display:flex;
      gap:8px;
      align-items:center;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.7);
      backdrop-filter: blur(8px);
      font-size: 13px;
      color:var(--muted);
      white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:99px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,.18);
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .chat{
      height: 520px;
      overflow:auto;
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      background:
        linear-gradient(to bottom, rgba(15,118,110,.06), transparent 140px),
        #fff;
    }

    .msg{
      display:flex;
      gap:10px;
      align-items:flex-start;
      max-width: 86%;
    }
    .msg.me{ margin-left:auto; flex-direction:row-reverse; }
    .bubble{
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 10px 12px;
      font-size: 14px;
      line-height: 1.45;
      background:#fff;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .msg.me .bubble{
      background: rgba(15,118,110,.10);
      border-color: rgba(15,118,110,.22);
    }
    .meta{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    .avatar{
      width:34px;height:34px;border-radius:12px;
      border:1px solid var(--border);
      background: #f8fafc;
      display:flex;align-items:center;justify-content:center;
      font-size: 13px;
      color: var(--muted);
      flex: 0 0 auto;
    }
    .msg.me .avatar{
      background: rgba(15,118,110,.12);
      border-color: rgba(15,118,110,.22);
      color: #0f766e;
    }

    .composer{
      display:flex;
      gap:10px;
      padding: 12px;
      border-top: 1px solid var(--border);
      background: rgba(255,255,255,.9);
      backdrop-filter: blur(8px);
    }

    input{
      flex:1;
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
      background:#fff;
    }
    input:focus{
      box-shadow: 0 0 0 4px var(--focus);
      border-color: rgba(59,130,246,.6);
    }

    button{
      border:1px solid rgba(15,118,110,.25);
      background: linear-gradient(180deg, rgba(15,118,110,.95), rgba(15,118,110,.85));
      color:#fff;
      border-radius:12px;
      padding: 0 16px;
      font-size: 14px;
      cursor:pointer;
      min-width: 92px;
    }
    button:hover{ filter: brightness(1.02); }
    button:disabled{
      opacity:.6; cursor:not-allowed;
    }

    .footer{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    @media (max-width: 640px){
      .chat{ height: 68vh; }
      .pill{ display:none; }
      .msg{ max-width: 94%; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="logo">
          <!-- Put your KIB logo file in the repo root as kib-logo.png -->
          <img src="kib-logo.png" alt="KIB Logo" onerror="this.style.display='none';" />
        </div>
        <div class="title">
          <h1>Chat3P</h1>
          <p>KIB Knowledge Assistant (Products â€¢ Policies â€¢ Procedures)</p>
        </div>
      </div>

      <div class="pill" id="statusPill">
        <span class="dot" id="statusDot"></span>
        <span id="statusText">Ready</span>
      </div>
    </div>

    <div class="card">
      <div id="chat" class="chat"></div>

      <div class="composer">
        <input id="inp" placeholder="Type your question..." autocomplete="off" />
        <button id="sendBtn" onclick="send()">Send</button>
      </div>
    </div>

    <div class="footer">
      <div>Tip: Ask in Arabic or English.</div>
      <div id="footNote">Chat3P â€¢ Web UI</div>
    </div>
  </div>

<script>
  // ðŸ”´ IMPORTANT: replace with your n8n Production Webhook URL
  const WEBHOOK_URL = "https://taherkib.app.n8n.cloud/webhook/bf161d07-e9be-48fe-bdfa-0ea9e3e1abb5";

  const chat = document.getElementById("chat");
  const inp = document.getElementById("inp");
  const btn = document.getElementById("sendBtn");

  const statusText = document.getElementById("statusText");
  const statusDot = document.getElementById("statusDot");

  function setStatus(text, ok=true){
    statusText.textContent = text;
    statusDot.style.background = ok ? "#22c55e" : "#ef4444";
    statusDot.style.boxShadow = ok ? "0 0 0 4px rgba(34,197,94,.18)" : "0 0 0 4px rgba(239,68,68,.18)";
  }

  function add(role, text){
    const row = document.createElement("div");
    row.className = "msg " + (role === "me" ? "me" : "bot");

    const avatar = document.createElement("div");
    avatar.className = "avatar";
    avatar.textContent = role === "me" ? "Me" : "3P";

    const bubbleWrap = document.createElement("div");

    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;

    const meta = document.createElement("div");
    meta.className = "meta";
    meta.textContent = new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});

    bubbleWrap.appendChild(bubble);
    bubbleWrap.appendChild(meta);

    row.appendChild(avatar);
    row.appendChild(bubbleWrap);

    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
  }

  async function send(){
    const msg = inp.value.trim();
    if(!msg) return;

    add("me", msg);
    inp.value = "";
    btn.disabled = true;
    setStatus("Thinking...", true);

    const res = await fetch(WEBHOOK_URL, {
  method: "POST",
  headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
  body: new URLSearchParams({
    message: msg,
    session_id: "web-1"
  })
});


      // If n8n returns non-JSON or error status
      if(!res.ok){
        const t = await res.text();
        add("bot", "n8n error: " + t);
        setStatus("Error (n8n)", false);
        btn.disabled = false;
        return;
      }

      const data = await res.json();
      add("bot", data.answer || "No answer returned.");
      setStatus("Ready", true);

    }catch(e){
      add("bot", "Connection error. Check WEBHOOK_URL or CORS on n8n.");
      setStatus("Disconnected", false);
    }finally{
      btn.disabled = false;
    }
  }

  // Enter key to send
  inp.addEventListener("keydown", (e) => {
    if(e.key === "Enter") send();
  });

  // Welcome message
  add("bot", "Hi â€” Iâ€™m Chat3P. Ask me about KIB products, policies, or procedures.");
  setStatus("Ready", true);
</script>
</body>
</html>
